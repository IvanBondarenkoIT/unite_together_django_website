{% load static %}
{% load news_tags %}

<section class="news-detail-container">
    <div class="news-detail-header">
        <h1 class="news-detail-title">{{ single_news.title_en|default:single_news.title }}</h1>
        
        <div class="news-detail-meta">
            {% if single_news.get_start_date_month and single_news.get_start_date_year %}
                <div class="news-detail-date" style="display: inline-block !important; background: #FED920 !important; color: #333 !important; padding: 8px 16px !important; border-radius: 20px !important; font-weight: 600 !important; font-size: 14px !important; margin-bottom: 20px !important;">
                    {{ single_news.get_start_date_month|translate_month:'en' }} {{ single_news.get_start_date_year }}
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Mobile Swipe Gallery -->
    {% if news_gallery %}
        <div class="mobile-swipe-gallery">
            <div class="swipe-container" id="swipeContainer">
                <div class="swipe-wrapper" id="swipeWrapper">
                    {% if single_news.image %}
                        <div class="swipe-slide">
                            <img src="{{ single_news.image.url }}" alt="{{ single_news.title_en|default:single_news.title }}">
                        </div>
                    {% endif %}
                    {% for i in news_gallery %}
                        <div class="swipe-slide">
                            <img src="{{ i.image.url }}" alt="{{ single_news.title_en|default:single_news.title }}">
                        </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="swipe-pagination">
                {% if single_news.image %}
                    <span class="pagination-bullet active"></span>
                {% endif %}
                {% for i in news_gallery %}
                    <span class="pagination-bullet"></span>
                {% endfor %}
            </div>
        </div>
    {% elif single_news.image %}
        <img src="{{ single_news.image.url }}" alt="{{ single_news.title_en|default:single_news.title }}" class="news-detail-image" style="width: 100% !important; max-height: 250px !important; object-fit: contain !important; border-radius: 12px !important; margin-bottom: 30px !important; background-color: #f8f9fa !important;">
    {% endif %}
    
    <div class="news-detail-content">
        {{ single_news.text_en|default:single_news.text|linebreaks }}
    </div>
    
    <!-- Next News Navigation -->
    {% if next_news %}
        <div class="next-news-navigation">
            <a href="{{ next_news.get_url_en }}" class="next-news-link">
                <div class="next-news-title">
                    Next news: {{ next_news.title_en|default:next_news.title }}
                </div>
                <div class="next-news-arrow">â†’</div>
            </a>
        </div>
    {% endif %}
</section>

<style>
    @import url('{% static "css/news/news.css" %}');
    
    /* Mobile Swipe Gallery */
    .mobile-swipe-gallery {
        margin: 20px 0;
        width: 100%;
    }
    
    .swipe-container {
        width: 100%;
        overflow: hidden;
        border-radius: 12px;
        position: relative;
        background: #f8f9fa;
    }
    
    .swipe-wrapper {
        display: flex;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        touch-action: pan-y pinch-zoom;
    }
    
    .swipe-slide {
        flex-shrink: 0;
        width: 100%;
        height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .swipe-slide img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
    }
    
    .swipe-pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 15px;
        padding: 10px 0;
    }
    
    .pagination-bullet {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ddd;
        transition: all 0.3s ease;
    }
    
    .pagination-bullet.active {
        background: #FED920;
        width: 24px;
        border-radius: 4px;
    }
</style>

<script>
    // Mobile Swipe Gallery
    const swipeWrapper = document.getElementById('swipeWrapper');
    const swipeContainer = document.getElementById('swipeContainer');
    const bullets = document.querySelectorAll('.pagination-bullet');
    let currentIndex = 0;
    let startX = 0;
    let currentX = 0;
    let isDragging = false;
    const totalSlides = bullets.length;
    
    function updateGallery(index) {
        if (index < 0) index = totalSlides - 1;
        if (index >= totalSlides) index = 0;
        
        currentIndex = index;
        const translateX = -currentIndex * 100;
        swipeWrapper.style.transform = `translateX(${translateX}%)`;
        
        bullets.forEach((bullet, i) => {
            bullet.classList.toggle('active', i === currentIndex);
        });
    }
    
    function handleTouchStart(e) {
        startX = e.touches[0].clientX;
        isDragging = true;
        swipeWrapper.style.transition = 'none';
    }
    
    function handleTouchMove(e) {
        if (!isDragging) return;
        
        currentX = e.touches[0].clientX;
        const diff = currentX - startX;
        const translateX = -currentIndex * 100 + (diff / swipeContainer.offsetWidth) * 100;
        swipeWrapper.style.transform = `translateX(${translateX}%)`;
    }
    
    function handleTouchEnd(e) {
        if (!isDragging) return;
        
        isDragging = false;
        swipeWrapper.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
        
        const diff = currentX - startX;
        const threshold = swipeContainer.offsetWidth * 0.2;
        
        if (Math.abs(diff) > threshold) {
            if (diff > 0) {
                updateGallery(currentIndex - 1);
            } else {
                updateGallery(currentIndex + 1);
            }
        } else {
            updateGallery(currentIndex);
        }
    }
    
    if (swipeContainer && swipeWrapper) {
        swipeContainer.addEventListener('touchstart', handleTouchStart, {passive: true});
        swipeContainer.addEventListener('touchmove', handleTouchMove, {passive: true});
        swipeContainer.addEventListener('touchend', handleTouchEnd, {passive: true});
        
        // Click on bullets
        bullets.forEach((bullet, index) => {
            bullet.addEventListener('click', () => updateGallery(index));
        });
    }
</script>
